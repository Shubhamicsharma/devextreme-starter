<dx-button
    stylingMode="contained"
    text="Open CDS Options Form"
    type="default"
    (onClick)="openModal()"
    [width]="200"
    icon="folder"
    class="mb-4"
>
</dx-button>

<dx-popup
    [visible]="showModal"
    [showTitle]="true"
    title="CDS Options Form"
    [hideOnOutsideClick]="false"
    [showCloseButton]="true"
    [width]="1000"
    [height]="'90vh'"
    (onHiding)="closeModal()"
    [dragEnabled]="true"
    [resizeEnabled]="true"
>
    <div class="dx-card p-3">
        <div class="flex-1 overflow-y-auto">
            <form
                [formGroup]="tradeForm"
                (ngSubmit)="onSubmit()"
                class="space-y-3"
            >
                <!-- basic details -->
                <section>
                    <div class="flex items-center gap-0.5 mb-2">
                        <span class="text-green-600">📊</span>
                        <span class="text-md font-semibold text-gray-900"
                            >Basic Information</span
                        >
                    </div>
                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mt-1"
                    >
                        <div
                            *ngFor="let field of basicFields"
                            class="relative"
                            [class.lg:col-span-2]="field.colSpan === 2"
                            [class.lg:col-span-3]="field.colSpan === 3"
                        >
                            <label
                                class="block text-xs font-semibold text-gray-700 mb-1"
                            >
                                {{ field.label
                                }}<span class="text-red-500">*</span>
                            </label>
                            <ng-container [ngSwitch]="field.type">
                                <dx-text-box
                                    *ngSwitchCase="'text'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>

                                <dx-select-box
                                    *ngSwitchCase="'select'"
                                    [formControlName]="field.name"
                                    [dataSource]="field.options || []"
                                    [searchEnabled]="true"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-select-box>

                                <dx-date-box
                                    *ngSwitchCase="'date'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                    type="date"
                                    displayFormat="yyyy-MM-dd"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-date-box>

                                <dx-text-area
                                    *ngSwitchCase="'textarea'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [height]="33"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-area>
                            </ng-container>
                        </div>
                    </div>
                </section>

                <!-- Section: Options Details -->
                <section>
                    <div class="flex items-center gap-0.5 mb-2">
                        <span class="text-green-600">📊</span>
                        <span class="text-md font-semibold text-gray-900"
                            >Options Details</span
                        >
                    </div>
                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mt-1"
                    >
                        <div
                            *ngFor="let field of optionFields"
                            class="relative"
                        >
                            <label
                                class="block text-xs font-semibold text-gray-700 mb-1"
                            >
                                {{ field.label
                                }}<span class="text-red-500">*</span>
                            </label>
                            <ng-container [ngSwitch]="field.type">
                                <dx-date-box
                                    *ngSwitchCase="'date'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                    type="date"
                                    displayFormat="yyyy-MM-dd"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-date-box>

                                <dx-text-box
                                    *ngSwitchDefault
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                            </ng-container>
                        </div>
                    </div>
                </section>

                <!-- Section: Swap Details -->
                <section>
                    <div class="flex items-center gap-0.5 mb-2">
                        <span class="text-purple-600">🔄</span>
                        <span class="text-md font-semibold text-gray-900"
                            >CDS Details</span
                        >
                    </div>
                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mt-1"
                    >
                        <div *ngFor="let field of cdsFields" class="relative">
                            <label
                                class="block text-xs font-semibold text-gray-700 mb-1"
                            >
                                {{ field.label
                                }}<span class="text-red-500">*</span>
                            </label>
                            <ng-container [ngSwitch]="field.type">
                                <dx-date-box
                                    *ngSwitchCase="'date'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                    type="date"
                                    displayFormat="yyyy-MM-dd"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-date-box>

                                <dx-select-box
                                    *ngSwitchCase="'select'"
                                    [formControlName]="field.name"
                                    [dataSource]="field.options || []"
                                    [searchEnabled]="true"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-select-box>

                                <dx-number-box
                                    *ngSwitchCase="'number'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [showSpinButtons]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-number-box>

                                <dx-text-box
                                    *ngSwitchDefault
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                            </ng-container>
                        </div>
                    </div>
                    <div class="mt-1">
                        <div class="mt-1 relative">
                            <label
                                class="block text-xs font-semibold text-gray-700 mb-1"
                            >
                                Trade Rationale<span class="text-red-500"
                                    >*</span
                                >
                            </label>
                            <dx-text-area
                                formControlName="tradeRationale"
                                [placeholder]="'Trade Rational'"
                                [stylingMode]="'outlined'"
                                [height]="60"
                                [width]="'100%'"
                            >
                                <dx-validator>
                                    <dxi-validation-rule
                                        type="required"
                                        message="This field is required"
                                    ></dxi-validation-rule> </dx-validator
                            ></dx-text-area>
                        </div>
                    </div>
                </section>

                <!-- Section: Trade Operations -->

                <section>
                    <div class="flex items-center gap-0.5 mb-2">
                        <span class="text-orange-500">⚙️</span>
                        <span class="text-md font-semibold text-gray-900"
                            >Trade Operations</span
                        >
                    </div>
                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mt-1"
                    >
                        <div
                            *ngFor="let field of tradeOpFields"
                            class="relative"
                        >
                            <label
                                class="block text-xs font-semibold text-gray-700 mb-1"
                            >
                                {{ field.label
                                }}<span class="text-red-500">*</span>
                            </label>
                            <ng-container [ngSwitch]="field.type">
                                <!-- For number inputs -->
                                <dx-number-box
                                    *ngSwitchCase="'number'"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [showSpinButtons]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-number-box>

                                <!-- For select/dropdown inputs -->
                                <dx-select-box
                                    *ngSwitchCase="'select'"
                                    [formControlName]="field.name"
                                    [dataSource]="field.options || []"
                                    [searchEnabled]="true"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-select-box>

                                <!-- Default text input -->
                                <dx-text-box
                                    *ngSwitchDefault
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder"
                                    [showClearButton]="true"
                                    [stylingMode]="'outlined'"
                                    [width]="'100%'"
                                >
                                    <dx-validator>
                                        <dxi-validation-rule
                                            type="required"
                                            message="This field is required"
                                        ></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                            </ng-container>
                        </div>
                    </div>
                </section>
                <!-- Action Buttons -->
                <div class="flex justify-end gap-2 mt-4">
                    <dx-button
                        text="Reset"
                        stylingMode="outlined"
                        type="normal"
                        [width]="100"
                        icon="refresh"
                        (onClick)="tradeForm.reset()"
                    >
                    </dx-button>

                    <dx-button
                        text="Save"
                        stylingMode="contained"
                        type="success"
                        [width]="100"
                        icon="save"
                        (onClick)="onSave()"
                    >
                    </dx-button>

                    <dx-button
                        text="Preview"
                        stylingMode="contained"
                        type="default"
                        [width]="120"
                        icon="check"
                        (onClick)="onPreview()"
                    >
                    </dx-button>

                    <dx-button
                        text="Submit"
                        stylingMode="contained"
                        type="default"
                        [width]="100"
                        icon="check"
                        (onClick)="onSubmit()"
                        [useSubmitBehavior]="true"
                    >
                    </dx-button>
                </div>

                <dx-validation-summary></dx-validation-summary>
            </form>
        </div>
    </div>
</dx-popup>
